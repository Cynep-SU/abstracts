Операционные системы и среды
============================

Работа с файлами и папками. Файловая система Windows. NTFS
----------------------------------------------------------

В ОС Windows поддерживается представление о файле как о **неструктурировпнной последовательномти байтов**. Основная
задача связять блоки диска с...

 

### Именование файлов

Для создания файла и присвоения ему имени в винде используется функция winapi CreateFile. Максимальная длина плного
имени файла при создании равна MAX_PATH и значение 260. А имя файла кодируется кодировкой UNICODE.

### Атрибуты файлов

В ОС Windows считается что файл - это не просто последовательность байтов, а совокупность атрибутов, и данные файла
являются лишь одним изи атрибутов - так называемый именнованный поток данных.  
Атрибуты хранятся в виде пары MFT

### Организация файлов и доступ к ним. Понятие об асинхронном вводе-выводе.

Файлы которые можно открыть в любом порядке - называются файлам прямого доступа.

### Директории. Логическая структура файлового архива

С точки зрения системы каталог - файл, содержащая таблицы с информацией о файлах, которые он содержит.

### Разделы диска. Операции монтирования

Физические диски можно разделять на логические диски(разделы). Которые представляются системе как отдельное физ.
устройство.

### Файловая система NTFS

[comment]: <> (![]&#40;../../Downloads/photo_2022-01-17_09-46-47.jpg&#41;)

### Кластеры

Обычно диски разбиты на блоки(секторы) размером - 512 б. Но удобнее оперировать блоками более крупного размера -
кластерами(NTFS)

### Главная файловая таблица MFT

В файловой системе NTFS запись о файле в каталоге соспоставляется записью о файле в главной файловой таблице диска -
MFT(master file table), которая содержит информацию о располажении данных файла. Имеются зеркала(копия системы файлов,
для восстановяение). Логгирование ошибок.

MFT - главная структура данных на диске, представляет собой обычный файл, содержащий до $$2^48$$ записей размером 1 Кб
каждая. Каждому файлу или каталогу соответствует одна запись. Записи 0-15 зарезервированы для служебных файлов, а
записи, начиная с 16-й, предназначены для файлов пользователей. Для больших файлов требуется...  
Чаще данные файла не помещаются в записи MFT. В этом случае вслед за заголовком в записи размещается список дисковых
блоков файла. Номера дисковых кластеров файлов можно узнать при помощи утилиты nfi.exe, входящией в состав ресурсов.

### Управление свободным и занятым дисковым пространством

Учёт свободных и занятых дисковых блоков ведётся при помощью векторонго сдвига.

### Реализация директорий

Каталогу соответствует запись в MFT, включающая совокупномть записей о файлах, что даёт возможность их быстро найти.

Для больших каталогов совокупность записей о файлах является нерезидентным атрибутом и организована в виде B+ дерева.

### Поиск файла по его имени

Абсолютный путь файла - F:\\tmp\\1.txt

\|

v

\\??\\F:\\tmp\\MyFile.txt

В каталоге \\??\\ ищется ссылка объекта на раздел жёсткого диска, например ...

В таблице MFT раздела, осузествляется навигация по каталогам, отыскивается файл.

### С точки зрения повторного анализа. Монтирование дисков.

Типовые возможности для монтирование ФС и образование жёстких и символических связей реализуется при помощи механизма,
называемого **точками повторного анализа**.

Поддерживается два вида ссылок:

- жёсткие - запись о файле появляется в новом каталоге, а MFT-запись этого файла включает счётчик количества ссылок на
  данный файл(Много файлов, но один сегмент диска, при изменении этого сегмента файлы меняются везде)

- символические

Символическая линковка - создание нового файла, который содержит путь к связываемому файлу. Ссылки этого типа могут
создавать и для файлов, и для каталогов, в том числе сетевых; они поддерживают связь между томами, используя
относительные пути.(ярлык)

1) Создайте на рабочем столе простой текстовый файл file1.txt и что-нибудь напишите в него. Теперь откройте командную
   строку и создай пару тройку жёстких ссылок с именами file2.txt file3.txt, как приведенно ниже.

Команды для создания файлов

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cd %userprofile%/desktop
fsutil hardlink create file2.txt file1.txt
fsutil hardlink file3.txt file1.txt
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

2) Создайте символьную ссылку на файл командной mklink:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
mklink D:/file2.txt %userprofile%/desktop/file1.txt
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

3) Создайте символьную ссылку на каталог командой /d

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Лабораторные работы
### Совместный доступ к файлу

Потоки должны синхронизировать доступ к совместно используемым файлам или каталогам, чтобы получить предсказуемый
результат. Для этого есть функции в апи LockFile and UnlockFile.

### Кэширование

- это загрузка файла или его часть в ОЗУ для быстрого доступа к нему.
